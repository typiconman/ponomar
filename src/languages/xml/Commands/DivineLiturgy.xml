<DATA>
<!-- THIS IS DivineLiturgy.xml VERSION 2.2 -->
<!-- XXX: STOP! YOU ARE NOT ALLOWED TO MODIFY THIS FILE WITHOUT CONSULTING ALEKSANDR FIRST -->
<!-- If  Transfer is True, then we run the scripture transfer algorithm; if it is 0, then we do nothing -->
<COMMAND Name="Transfer" Value="nday &gt;= 52 || nday &lt; -55" Comment="This determines whether the sequential readings may be skipped or transferred." Cmd="GS == 1"/>
<COMMAND Name="Transfer" Value="nday &gt;= 52 || nday &lt; -55" Comment="This determines whether the sequential readings may be skipped or transferred." Cmd="GS == 0"/>
<COMMAND Name="Suppress" Value="doy == 4 &amp;&amp; dow != 0 &amp;&amp; dow != 6" Comments="Eve of Theophany can have seq. readings on Sat. (see Table 25b, 2019) and on Sun. (see Table 24b, 2087)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="doy == 357 &amp;&amp; dow != 6" Comments="Eve of Nativity can have seq. readings on Sat. (see Table 27a, 2084)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="(doy == 358 || doy == 5)" Comment="Nativity and Theophany never have seq. readings"/>
<COMMAND Name="Suppress" Value="(doy == 256 || doy == 217) &amp;&amp; dow == 0" Comment="Suppress seq. readings if Exaltation or Transfiguration falls on Sunday"/>
<!-- If Suppress is True, then the readings for the day are not read and not transferred -->
<!-- If Class3Transfers is TRUE, then the daily readings should be transferred to another day. -->
<!-- I am making this rule and Suppress mutually exclusive, but I don't think this should affect anything -AA -->
<COMMAND Name="Class3Transfers" Value="!(doy == 358 || doy == 357 || doy == 4 || doy == 5 || doy == 256 || doy == 217) &amp;&amp; ((dRank &gt;= 5 &amp;&amp; dow != 0) || dRank == 8)" Cmd="GS == 1 || GS == 0"/>
<COMMAND Name="Class3Transfers" Value="(doy == 3 &amp;&amp; dow == 5) || (doy == 356 &amp;&amp; dow == 5)" Comment="There is no Liturgy on Friday when the Royal Hours occur. The readings are moved to Thursday." Cmd="GS == 1 || GS == 0"/>
<COMMAND Name="Class3Transfers" Value="(doy == 256 || doy == 217) &amp;&amp; dow != 0" Comments="Exaltation and Transfiguration readings are only transferred if it's not a Sunday"/>
<!-- Can I accept transfers from Tomorrow today -->
<!-- XXX: check of nday > -63 and nday <= 0 is superfluous and will be removed -->
<COMMAND Name="TransferRulesB" Value="dow != 0 &amp;&amp; !(nday >= -63 &amp;&amp; nday &lt;= 0) &amp;&amp; doy != 338" Cmd="GS == 1" Comment="This determines the rules used to transfer the readings to the previous day. Note that St. Nicholas's day has a special set of rules"/>
<!-- Can I accept transfers from Yesterday today -->
<COMMAND Name="TransferRulesF" Value="!(nday >= -63 &amp;&amp; nday &lt;= 0) &amp;&amp; (dow == 2  &amp;&amp; doy != 339) || ((doy == 340 &amp;&amp; (dow != 0 &amp;&amp; dow != 2)))" Cmd="GS == 1" Comment="This determines the rules used to transfer the readings to the next day (forwards). Note that St. Nicholas's day has a special set of rules."/>
<COMMAND Name="TransferRulesB" Value="dow != 0 &amp;&amp; !(nday >= -63 &amp;&amp; nday &lt;= 0) &amp;&amp; doy != 338" Cmd="GS == 0" Comment="This determines the rules used to transfer the readings to the previous day. Note that St. Nicholas's day has a special set of rules"/>
<COMMAND Name="TransferRulesF" Value="!(nday >= -63 &amp;&amp; nday &lt;= 0) &amp;&amp; (dow == 2  &amp;&amp; doy != 339) || ((doy == 340 &amp;&amp; (dow != 0 &amp;&amp; dow != 2)))" Cmd="GS == 0" Comment="This determines the rules used to transfer the readings to the next day (forwards). Note that St. Nicholas's day has a special set of rules."/>

<!-- THESE RULES ALLOW US TO SUPPRESS SEQUENTIAL READINGS IF THEY HAVE BEEN READ BEFORE -->
<!-- NB: READINGS MAY NOT BE SUPPRESSED IN SEPTEMBER, SINCE EPISTLE READING IS UNIQUE UNDER LJ SCHEME -->
<!-- XXX: FIXME for these rubrics to be useable, we must check if Menaion has readings as well, currently not implemented
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; nday == -96 &amp;&amp; ndayP == 289 &amp;&amp; (doy &gt;= 3 &amp;&amp; doy &lt;= 4)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; nday == -95 &amp;&amp; ndayP == 290 &amp;&amp; (doy &gt;= 4 &amp;&amp; doy &lt;= 5)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; nday == -94 &amp;&amp; ndayP == 291 &amp;&amp; (doy &gt;= 5 &amp;&amp; doy &lt;= 6)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; nday == -93 &amp;&amp; ndayP == 292 &amp;&amp; (doy &gt;= 6 &amp;&amp; doy &lt;= 7)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; nday == -92 &amp;&amp; ndayP == 293 &amp;&amp; (doy &gt;= 7 &amp;&amp; doy &lt;= 8)" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; ((ndayP == 282 &amp;&amp; doy &lt;= 6)  || (nday == 282 &amp;&amp; doy &gt;= 361))" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; ((ndayP == 283 &amp;&amp; doy &lt;= 7)  || (nday == 283 &amp;&amp; doy &gt;= 362))" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; ((ndayP == 284 &amp;&amp; doy &lt;= 8)  || (nday == 284 &amp;&amp; doy &gt;= 363))" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; ((ndayP == 285 &amp;&amp; doy &lt;= 9)  || (nday == 285 &amp;&amp; doy &gt;= 364))" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="dRank &gt;= 2 &amp;&amp; ndayP == 286 &amp;&amp; doy &lt;= 10" Cmd="GS == 1"/>
--><!-- XXX: the rules below look so complicated, I don't know how to interpret them.
<COMMAND Name="Suppress" Value="(doy == 355 || (doy == 356 &amp;&amp; dow != 1) || (doy == 357 &amp;&amp; (dow &gt;= 3 || dow == 0)) || (doy == 358 &amp;&amp; (dow &gt;= 4 || dow == 0)) || (doy == 359 &amp;&amp; (dow &gt;= 5 || dow == 0)) || (doy == 360 &amp;&amp; (dow == 6 || dow == 0)) || (doy == 361 &amp;&amp;  dow == 0)) &amp;&amp; (ndayF &gt;= -125 &amp;&amp; ndayF &lt;= -105)" Comment="This suppresses the readings that occur over Christmas in the case that there are 3 repeats and it is the 31st week of effective readings." Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="(doy == 362 || (doy == 363 &amp;&amp; dow != 1) || (doy == 364 &amp;&amp; (dow &gt;= 3 || dow == 0)) || (doy == 361 &amp;&amp; dow != 0) || (doy == 360 &amp;&amp; (dow &lt; 6 &amp;&amp; dow != 0)) || (doy == 359 &amp;&amp; (dow &lt; 5 &amp;&amp; dow != 0)) || (doy == 358 &amp;&amp; (dow &lt; 4 &amp;&amp; dow != 0)) || (doy == 357 &amp;&amp; (dow &lt; 3 &amp;&amp; dow != 0)) || (doy == 356 &amp;&amp; (dow == 1))) &amp;&amp; (ndayF &gt;= -118 &amp;&amp; ndayF &lt;= -81)" Comment="This suppresses the readings that occur over Christmas in the case that there are 2 repeats and it is the 32nd week of effective readings." Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value=" ((doy == 0 &amp;&amp; (dow &gt;= 4 || dow == 0)) || (doy == 1 &amp;&amp; (dow &gt;= 5 || dow == 0)) || (doy == 2 &amp;&amp; (dow == 6 || dow == 0)) || (doy == 3 &amp;&amp;  dow == 0)) &amp;&amp;  (nday &gt;= -118 &amp;&amp; nday &lt;= -81)" Comment="This suppresses the readings that occur over Christmas in the case that there are at least 2 repeats and it is the 32nd week of effective readings and it is January." Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="(doy == 4 || (doy == 5 &amp;&amp; dow != 1) || (doy == 6 &amp;&amp; (dow &gt;= 3 || dow == 0)) || (doy == 7 &amp;&amp; (dow &gt;= 4 || dow == 0)) || (doy == 8 &amp;&amp; (dow &gt;= 5 || dow == 0)) || (doy == 9 &amp;&amp; (dow == 6 || dow == 0)) || (doy == 10 &amp;&amp;  dow == 0)|| (doy == 3 &amp;&amp; dow != 0) || (doy == 2 &amp;&amp; (dow &lt; 6 &amp;&amp; dow != 0)) || (doy == 1 &amp;&amp; (dow &lt; 5 &amp;&amp; dow != 0)) || (doy == 0 &amp;&amp; (dow &lt; 4 &amp;&amp; dow != 0))) &amp;&amp; (nday &lt;= -78 &amp;&amp; nday &gt;= -111)" Comment="This suppresses the readings for the case that there is only 1 repeat and it is the 33rd week of effective readings" Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="((doy == 364 &amp;&amp; (dow &lt; 3 &amp;&amp; dow != 0)) || (doy == 363 &amp;&amp; (dow == 1))) &amp;&amp; (ndayF &lt;= -78 &amp;&amp; ndayF &gt;= -111)" Comment="This suppresses the readings for the case that there is at least 1 repeat and it is the 33rd week of effective readings and it is still the old year." Cmd="GS == 1"/>
<COMMAND Name="Suppress" Value="(doy >= 360 &amp;&amp; doy &lt;= 364) &amp;&amp; dow == 0" Comment="This is to suppress the readings on the Sunday after Christmas." Cmd="GS == 0"/>
<COMMAND Name="Suppress" Value="(doy >= 6 &amp;&amp; doy &lt;= 12) &amp;&amp; (dow == 0) &amp;&amp; nday != -77 &amp;&amp; nday != -70" Comment="This is to suppress the readings on the Sunday after Theophany, unless it is the Sunday of Zacchaeus or the Sunday of the Publican and the Pharisee." Cmd="GS == 0"/> --> <!-- Correcting a minor error. 
<COMMAND Name="Suppress" Value="(nday - ndayF == 392) &amp;&amp; ((nday >= 246) &amp;&amp; ((doy >= 355 &amp;&amp; doy &lt;= 364) || ((doy >= 350 &amp;&amp; doy &lt;= 354) &amp;&amp; (dow == 6 || dow == 0))))" Cmd="GS == 0" Comment="This skips the readings over Christmas in the case that there is a full set of repeats in the Jordanville version."/>
<COMMAND Name="Suppress" Value="(ndayP - nday == 392) &amp;&amp; ((ndayP >= 246) &amp;&amp; ((doy >= 0 &amp;&amp; doy &lt;= 6) || ((doy >= 7 &amp;&amp; doy &lt;= 13) &amp;&amp; (dow == 6 || dow == 0))))" Cmd="GS == 0" Comment="This skips the readings in January Christmas in the case that there is a full set of repeats in the Jordanville version."/>
<COMMAND Name="Suppress" Value="(nday - ndayF == 385) &amp;&amp; ((nday >= 239) &amp;&amp; ((doy >= 355 &amp;&amp; doy &lt;= 364) || ((doy >= 350 &amp;&amp; doy &lt;= 354) &amp;&amp; (dow == 6 || dow == 0))))" Cmd="GS == 0" Comment="This skips the readings over Christmas in the case that there are 4 repeats in the Jordanville version."/>
<COMMAND Name="Suppress" Value="(ndayP - nday == 385) &amp;&amp; ((ndayP >= 239) &amp;&amp; ((doy >= 0 &amp;&amp; doy &lt;= 6) || ((doy >= 7 &amp;&amp; doy &lt;= 13) &amp;&amp; (dow == 6 || dow == 0))))" Cmd="GS == 0" Comment="This skips the readings in January Christmas in the case that there are 4 repeats in the Jordanville version."/>
<COMMAND Name="Suppress" Value="(ndayP - nday == 364) &amp;&amp; ((ndayP &lt;= 280 &amp;&amp; ndayP >= 274) &amp;&amp; ((doy >= 0 &amp;&amp; doy &lt;= 6) || ((doy >= 7 &amp;&amp; doy &lt;= 13) &amp;&amp; (dow == 6 || dow == 0))))" Cmd="GS == 0" Comment="This skips the readings in January Christmas in the case that there is a single repeat (33rd Week) in the Jordanville version."/>-->
</DATA>
